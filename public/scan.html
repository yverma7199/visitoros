<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Security Scan Terminal ‚Äî VisitorOS</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=Syne+Mono&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    body{min-height:100vh;background:#080810;color:#e2e2f0;font-family:'Space Grotesk',sans-serif;display:flex;align-items:center;justify-content:center;padding:20px}
    .terminal{background:#0f0f1a;border:1px solid #1e1e2e;border-radius:20px;padding:36px;width:100%;max-width:500px;position:relative;overflow:hidden}
    .terminal::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,#7c6af0,#5af07c)}
    .t-header{display:flex;align-items:center;gap:14px;margin-bottom:28px;padding-bottom:20px;border-bottom:1px solid #1e1e2e}
    .t-icon{width:48px;height:48px;background:rgba(124,106,240,0.12);border:1px solid rgba(124,106,240,0.25);border-radius:13px;display:flex;align-items:center;justify-content:center;font-size:22px}
    h2{font-size:20px;font-weight:700;letter-spacing:-.3px}
    .subtitle{font-size:12px;color:#6b6b8a;margin-top:3px;font-family:'Syne Mono',monospace}
    label{display:block;font-size:10px;color:#6b6b8a;letter-spacing:2px;text-transform:uppercase;font-family:'Syne Mono',monospace;margin-bottom:8px}
    textarea{width:100%;height:110px;background:#131320;border:1px solid #1e1e2e;color:#e2e2f0;padding:12px;border-radius:10px;font-family:'Syne Mono',monospace;font-size:12px;resize:vertical;outline:none;transition:border-color .2s}
    textarea:focus{border-color:#7c6af0}
    .scan-btn{margin-top:12px;width:100%;padding:14px;background:#7c6af0;color:#fff;border:none;border-radius:11px;font-family:'Space Grotesk',sans-serif;font-size:15px;font-weight:600;cursor:pointer;transition:background .2s,transform .15s;display:flex;align-items:center;justify-content:center;gap:8px}
    .scan-btn:hover{background:#6b59df;transform:translateY(-1px)}
    .scan-btn:active{transform:translateY(0)}
    #result{margin-top:18px;padding:18px;border-radius:12px;font-size:14px;line-height:1.9;display:none}
    #result.success{background:rgba(90,240,124,.07);border:1px solid rgba(90,240,124,.22);color:#5af07c}
    #result.error{background:rgba(240,90,90,.07);border:1px solid rgba(240,90,90,.22);color:#f05a5a}
    .r-title{font-size:17px;font-weight:700;display:block;margin-bottom:10px}
    .photo-row{display:flex;align-items:center;gap:12px;margin-bottom:8px}
    .visitor-photo{width:52px;height:52px;border-radius:50%;object-fit:cover;border:2px solid rgba(90,240,124,.3)}
    .instructions{margin-top:22px;padding:14px;background:rgba(124,106,240,.05);border:1px solid rgba(124,106,240,.1);border-radius:10px;font-size:12px;color:#6b6b8a;font-family:'Syne Mono',monospace;line-height:2}
    .back{display:inline-block;margin-top:18px;color:#6b6b8a;font-size:13px;text-decoration:none;transition:color .2s}
    .back:hover{color:#7c6af0}
    .clear-btn{margin-top:8px;background:none;border:1px solid #1e1e2e;color:#6b6b8a;font-size:12px;padding:6px 14px;border-radius:7px;cursor:pointer;font-family:'Space Grotesk',sans-serif;transition:all .2s}
    .clear-btn:hover{border-color:#7c6af0;color:#7c6af0}
  </style>
</head>
<body>
  <div class="terminal">
    <div class="t-header">
      <div class="t-icon">üîê</div>
      <div>
        <h2>Security Scan Terminal</h2>
        <div class="subtitle">Entry Pass Verification ¬∑ VisitorOS</div>
      </div>
    </div>

    <label>QR Code Data</label>
    <textarea id="qrInput" placeholder='Paste the scanned QR text here:&#10;&#10;{"visitor_id":"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx","type":"ENTRY_PASS","v":1}'></textarea>
    <button class="scan-btn" onclick="doScan()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
      Verify Entry Pass
    </button>
    <button class="clear-btn" onclick="clearResult()">Clear</button>

    <div id="result"></div>

    <div class="instructions">
      HOW TO USE:<br>
      1. Use a QR scanner app to scan visitor's QR<br>
      2. Copy the JSON text output from the scanner<br>
      3. Paste above and click Verify<br>
      4. üü¢ GREEN = ALLOW ENTRY &nbsp; üî¥ RED = DENY ENTRY
    </div>

    <a href="/" class="back">‚Üê Back to Registration</a>
  </div>

  <script>
    async function doScan() {
      const qr_data  = document.getElementById('qrInput').value.trim();
      const resultEl = document.getElementById('result');
      if (!qr_data) {
        resultEl.style.display = 'block';
        resultEl.className = 'error';
        resultEl.innerHTML = '<span class="r-title">‚ö†Ô∏è Input Required</span>Please paste the QR code data first.';
        return;
      }
      resultEl.style.display = 'block';
      resultEl.className = '';
      resultEl.innerHTML = '<span style="color:#6b6b8a">Verifying‚Ä¶</span>';

      try {
        const res  = await fetch('/scan', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ qr_data }),
        });
        const data = await res.json();

        if (data.success) {
          const v   = data.visitor;
          const scannedAt = new Date(v.scan_time).toLocaleString('en-IN', { dateStyle:'medium', timeStyle:'short' });
          const photoHtml = v.photo_url
            ? `<div class="photo-row"><img class="visitor-photo" src="${v.photo_url}" alt=""> <span>Verify face against ID</span></div>`
            : '';
          resultEl.className = 'success';
          resultEl.innerHTML = `
            <span class="r-title">‚úÖ ENTRY GRANTED</span>
            ${photoHtml}
            üë§ &nbsp;${v.name}<br>
            üì± &nbsp;${v.mobile}<br>
            üéØ &nbsp;Meeting: ${v.person_to_meet}<br>
            üìã &nbsp;Purpose: ${v.purpose}<br>
            üìÖ &nbsp;${v.visit_date} at ${v.visit_time}<br>
            ‚è±Ô∏è &nbsp;Logged at: ${scannedAt}
          `;
        } else {
          resultEl.className = 'error';
          resultEl.innerHTML = `<span class="r-title">‚ùå ENTRY DENIED</span>${data.error}${data.scan_time ? '<br><br>‚è±Ô∏è First used: ' + new Date(data.scan_time).toLocaleString('en-IN') : ''}`;
        }
      } catch (err) {
        resultEl.className = 'error';
        resultEl.innerHTML = `<span class="r-title">‚ùå Connection Error</span>${err.message}<br><br>Check that the server is running.`;
      }
    }

    function clearResult() {
      document.getElementById('qrInput').value = '';
      const r = document.getElementById('result');
      r.style.display = 'none';
      r.innerHTML = '';
    }

    document.getElementById('qrInput').addEventListener('keydown', e => {
      if (e.ctrlKey && e.key === 'Enter') doScan();
    });
  </script>
</body>
</html>
